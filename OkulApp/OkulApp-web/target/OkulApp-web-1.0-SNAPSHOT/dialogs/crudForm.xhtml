<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:body>          
        <h:form id="crudFormForm">
            <p:panel>
                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton update="@(.crudUpdate)"
                                         actionListener="#{crudMB.saveRecord()}" style="float: left" 
                                         styleClass="ui-priority-primary" icon="fa fa-save" value="#{texts.save}">
                        </p:commandButton>

                        <span class="ui-separator">
                            <span class="ui-icon pi pi-ellipsis-v" />
                        </span>

                        <p:commandButton immediate="true" actionListener="#{crudMB.cancelRecord()}"
                                         update="@(.crudUpdate)" style="float: right" icon="fa fa-remove" value="#{texts.cancel}">
                        </p:commandButton>
                    </f:facet>

                </p:toolbar>

            </p:panel>


            <p:panel id="crudPanel" styleClass="ui-fluid" style="width: 100%">
                <p:messages id="msgs"/>                
                <c:forEach   items="#{crudMB.crudForm.formControls}" var="fc">
                    <p:panelGrid layout="grid" columns="2"  columnClasses="ui-grid-col-4,ui-grid-col-8"
                                 styleClass="ui-panelgrid-blank" rendered="#{crudMB.crudForm != null}" style="width: 100%;">
                        <p:outputLabel value="#{fc.label}"/>
                        <p:inputText rendered="#{'text' eq fc.type}" label="#{fc.label}" value="#{fc.value}" required="#{fc.required}"/>                 
                        <p:selectBooleanCheckbox rendered="#{'checkbox' eq fc.type}" value="#{fc.value}" required="#{fc.required}" label="#{fc.label}"/>
                        <p:calendar rendered="#{'date' eq fc.type}" value="#{fc.value}" required="#{fc.required}" label="#{fc.label}" locale="tr" lang="tr" pattern="#{fc.pattern}"  showOn="button" mask="true"/>
                        <p:inputNumber rendered="#{'double' eq fc.type}" value="#{fc.value}" required="#{fc.required}" decimalPlaces="#{fc.decimalPlaces}" thousandSeparator="#{fc.thousandSeparator}" decimalSeparator="#{fc.decimalSeparator}" label="#{fc.label}"/>
                        <p:spinner rendered="#{'integer' eq fc.type}" value="#{fc.value}" required="#{fc.required}"  label="#{fc.label}"/>
                        <p:inputMask rendered="#{'mask' eq fc.type}" value="#{fc.value}" required="#{fc.required}"  mask="#{fc.mask}" label="#{fc.label}"/>
                        <p:selectManyMenu class="selectObject" rendered="#{'selectManyDb' eq fc.type}" value="#{fc.value}" required="#{fc.required}" label="#{fc.label}" filter="true" filterMatchMode="contains" showCheckbox="true">
                            <f:selectItems var="itm" value="#{crudMB.getSelectItemsFromCacheDB(fc.name, fc.dbName, fc.tableName, fc.itemQuery, fc.itemValueField, fc.itemLabelField)}" itemLabel="#{itm[fc.itemLabelField]}" itemValue="#{itm[fc.itemValueField]}" />
                            <f:converter converterId="SelectConverter" />
                        </p:selectManyMenu>
                        <p:selectManyMenu rendered="#{'selectMany' eq fc.type}" value="#{fc.value}" required="#{fc.required}" label="#{fc.label}" filter="true" filterMatchMode="contains" showCheckbox="true">
                            <f:selectItems var="itm" value="#{fc.items}" itemLabel="#{itm.label}" itemValue="#{itm.value}" />
                            <f:converter converterId="SelectConverter" />
                        </p:selectManyMenu>
                        <p:selectOneMenu id="#{fc.generatedId}" rendered="#{'selectOneDb' eq fc.type}" value="#{fc.value}" required="#{fc.required}" label="#{fc.label}" >
                            <p:ajax rendered="#{fc.ajaxUpdateFieldName ne ''}" listener="#{crudMB.onSelectOneChanged}" update="#{fc.ajaxUpdateFieldName} @(.selectObject)" />
                            <f:selectItem itemLabel="#{texts.selectOne}" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems var="itm" value="#{crudMB.getSelectItemsFromCacheDB(fc.name, fc.dbName, fc.tableName, fc.itemQuery, fc.itemValueField, fc.itemLabelField)}" itemLabel="#{itm[fc.itemLabelField]}" itemValue="#{itm[fc.itemValueField]}" />
                            <f:converter converterId="SelectConverter" />
                        </p:selectOneMenu>
                        <p:selectOneMenu rendered="#{'selectOne' eq fc.type}" value="#{fc.value}" required="#{fc.required}" label="#{fc.label}">
                            <f:selectItem itemLabel="#{texts.selectOne}" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems var="itm" value="#{fc.items}" itemLabel="#{itm.label}" itemValue="#{itm.value}" />
                            <f:converter converterId="SelectConverter" />
                        </p:selectOneMenu>
                        <p:inputTextarea widgetVar="#{fc.fieldName}" rendered="#{'codemirror' eq fc.type}"  required="#{fc.required}"
                                         value="#{fc.value}" label="#{fc.label}" />
                    </p:panelGrid>
                </c:forEach>                    
            </p:panel>    
        </h:form>
    </h:body>
</html>

