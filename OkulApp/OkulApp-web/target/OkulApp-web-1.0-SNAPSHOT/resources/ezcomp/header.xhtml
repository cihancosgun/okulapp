<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <!-- INTERFACE -->
    <cc:interface>
        <cc:attribute name = "shortHeader" />
        <cc:attribute name = "header" />
        <cc:attribute name = "userName" />
        <cc:attribute name = "logoutText" />
        <cc:attribute name = "logoutButtonAction" 
                      method-signature = "java.lang.Void signOut()" />
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>

        <header class="main-header">           
            <!-- Logo -->
            <a href="#" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini">#{cc.attrs.shortHeader}</span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg">#{cc.attrs.header}</span>
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                    <span class="sr-only"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <h:form>
                    <h:panelGroup id="navBarCustomMenu" class="navbar-custom-menu" layout="block">
                        <p:growl id="myNotifyMsgs" showDetail="true"/>
                        <ul class="nav navbar-nav">
                            <li class="dropdown messages-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-envelope-o"></i>
                                    <h:panelGroup id="messageCount" class="label label-success" rendered="#{not chatMB.myUnreadedMessages.isEmpty()}">
                                        ${chatMB.myUnreadedMessages.size()} 
                                    </h:panelGroup>
                                    <p:poll listener="#{chatMB.refreshMyUnreadMessages()}" interval="10" update="navBarCustomMenu myNotifyMsgs"/>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class="header">${chatMB.myUnreadedMessages.size()} adet okunmamış mesajınız var.</li>
                                    <li>
                                        <!-- inner menu: contains the actual data -->
                                        <ul class="menu">
                                            <c:forEach items="#{chatMB.myUnreadedMessages}" var="rec">
                                                <li><!-- start message -->
                                                    <p:commandLink actionListener="#{dispatcherMB.switchToChatPage()}" immediate="true" update="contentCmp:contentPanelGroup">
                                                        <div class="pull-left">
                                                            <p:graphicImage value="#{chatMB.handleImageFileDownload(securityMB.getUserFromEmail(rec.messages.senderEmail).image)}" stream="false" class="img-circle" alt="Sender User Image"/>
                                                        </div>
                                                        <h4>
                                                            #{rec.messages.senderNameSurname}                                                            
                                                        </h4>
                                                        <small><i class="fa fa-clock-o"></i> #{chatMB.formatDateTime(rec.messages.sendingTime)}</small>
                                                        <p>#{rec.messages.message}</p>
                                                    </p:commandLink>
                                                </li>
                                                <!-- end message -->
                                            </c:forEach>
                                        </ul>
                                    </li>
                                    <li class="footer"><p:commandLink immediate="true" actionListener="#{dispatcherMB.switchToChatPage()}" update="contentCmp:contentPanelGroup">Tüm Mesajları Göster</p:commandLink></li>
                                </ul>
                            </li>

                            <li class="dropdown notifications-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-bell-o"></i>
                                    <h:panelGroup class="label label-warning" rendered="#{not boardMB.myUnreadedBoard.isEmpty()}">
                                        ${boardMB.myUnreadedBoard.size()}
                                    </h:panelGroup>
                                    <p:poll listener="#{boardMB.refreshMyBoard()}" interval="10" update="navBarCustomMenu myNotifyMsgs"/>
                                </a>
                                <ul class="dropdown-menu"> 
                                    <li class="header">${boardMB.myUnreadedBoard.size()} adet okunmamış bildiriminiz var.</li>
                                    <li>
                                        <!-- inner menu: contains the actual data -->
                                        <ul class="menu">
                                            <c:forEach items="#{boardMB.myUnreadedBoard}" var="rec">
                                                <li><!-- start message -->
                                                    <p:commandLink actionListener="#{dispatcherMB.switchToShowNotify(rec)}" immediate="true" update="contentCmp:contentPanelGroup">
                                                        <div class="pull-left">
                                                            <img src="#{request.contextPath}/images/images.png" class="img-circle" alt="nfimg" width="30px;"/>
                                                        </div>
                                                        <h4> 
                                                            #{rec.senderNameSurname}                                                            
                                                        </h4>
                                                        <small><i class="fa fa-clock-o"></i> #{chatMB.formatDateTime(rec.startDate)}</small>
                                                        <p>#{rec.message}</p>
                                                    </p:commandLink>
                                                </li>
                                                <!-- end message -->
                                            </c:forEach>
                                        </ul>
                                    </li>
                                    <li class="footer"><p:commandLink actionListener="#{dispatcherMB.switchToBoardPage()}" immediate="true" update="contentCmp:contentPanelGroup">Tüm Bildirimleri Göster</p:commandLink></li>
                                </ul>
                            </li>

                            <!-- User Account: style can be found in dropdown.less -->
                            <li class="dropdown user user-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">                                
                                    <span class="hidden-xs">#{cc.attrs.userName}</span>
                                </a>
                                <ul class="dropdown-menu">                               
                                    <li class="user-footer">                                    
                                        <div class="pull-right">     
                                            <p:commandLink class="btn btn-default btn-flat" actionListener="#{securityMB.signOut()}" value="#{cc.attrs.logoutText}" immediate="true" ajax="false"/>
                                        </div>
                                    </li>
                                </ul>
                            </li>                      
                        </ul>

                    </h:panelGroup>    
                </h:form>
            </nav>
        </header>
    </cc:implementation>
</html>